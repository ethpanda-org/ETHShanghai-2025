# ✅ 部署完成 - 测试指南

## 📋 部署摘要

### 服务状态
- ✅ **Anvil**: 运行中 (http://127.0.0.1:8545)
- ✅ **前端应用**: 运行中 (http://localhost:3000)

### 合约地址
```
FocusBond:  0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0
FocusToken: 0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512
USDC:       0x5FbDB2315678afecb367f032d93F642f64180aa3
```

### 测试账户
```
地址: 0x891402c216Dbda3eD7BEB0f95Dd89b010523642A
ETH余额: 1.0000 ETH
FOCUS余额: 2000.00 FOCUS
```

---

## 🧪 测试步骤

### 步骤1: 连接钱包并验证余额

1. **打开浏览器**访问: http://localhost:3000

2. **连接MetaMask钱包**:
   - 点击页面上的"连接钱包"按钮
   - 如果还没有导入测试账户，请在MetaMask中导入:
     - 私钥: `0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80`
     - 或使用你的账户: `0x891402c216Dbda3eD7BEB0f95Dd89b010523642A`
   - 确保网络设置为 "Anvil Local" (Chain ID: 31337, RPC: http://127.0.0.1:8545)

3. **验证余额显示**:
   - 页面顶部应该显示: **`2000.00 FOCUS`** ✅
   - 不应该显示科学计数法或异常大的数字 ❌
   - ETH余额应该显示约 `1.0 ETH`

4. **检查"我的"页面**:
   - 点击底部导航栏的"我的"
   - 应该显示 `2000 FOCUS 代币`

---

### 步骤2: 测试创建专注会话

1. **选择专注时长**:
   - 在主页选择一个短时间（建议1-5分钟，方便测试）
   - 或自定义时间

2. **开始专注**:
   - 点击"开始专注"按钮
   - MetaMask会弹出交易确认
   - 确认交易（质押0.1 ETH）

3. **验证会话创建**:
   - 交易成功后，页面应该显示倒计时
   - 顶部应该显示"专注中"状态
   - 底部应该显示当前会话信息

4. **检查链上数据**:
   ```bash
   # 在终端运行以下命令验证会话已创建
   cast call 0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0 \
     "sessions(address)" \
     0x891402c216Dbda3eD7BEB0f95Dd89b010523642A \
     --rpc-url http://127.0.0.1:8545
   ```

---

### 步骤3: 测试中断会话

1. **中断会话**:
   - 在专注过程中，点击"中断专注"按钮
   - MetaMask会弹出交易确认
   - 确认交易

2. **验证中断惩罚**:
   - 交易成功后，应该显示中断费用
   - FOCUS余额应该减少（被扣除中断费用）
   - 页面应该返回到未专注状态

3. **检查历史记录**:
   - 进入"我的"页面
   - 查看专注历史
   - 应该看到一条"中断"记录，包含:
     - 中断时间
     - 目标分钟数
     - 质押金额
     - 中断费用
     - 交易哈希（可点击复制）

4. **验证链上数据**:
   ```bash
   # 检查FOCUS余额是否减少
   cast call 0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512 \
     "balanceOf(address)" \
     0x891402c216Dbda3eD7BEB0f95Dd89b010523642A \
     --rpc-url http://127.0.0.1:8545
   ```

---

### 步骤4: 测试完成会话

1. **创建新会话**:
   - 创建一个1分钟的专注会话
   - 等待倒计时结束

2. **完成会话**:
   - 倒计时结束后，点击"完成专注"按钮
   - 或者会话应该自动完成
   - MetaMask会弹出交易确认
   - 确认交易

3. **验证完成奖励**:
   - 交易成功后，应该显示完成奖励
   - FOCUS余额应该增加（获得奖励）
   - 页面应该显示成功完成的提示

4. **检查历史记录**:
   - 进入"我的"页面
   - 查看专注历史
   - 应该看到一条"完成"记录，包含:
     - 完成时间
     - 目标分钟数
     - 质押金额
     - 完成奖励
     - 交易哈希（可点击复制）

5. **验证链上数据**:
   ```bash
   # 检查FOCUS余额是否增加
   cast call 0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512 \
     "balanceOf(address)" \
     0x891402c216Dbda3eD7BEB0f95Dd89b010523642A \
     --rpc-url http://127.0.0.1:8545
   ```

---

### 步骤5: 验证历史记录和统计

1. **检查专注历史**:
   - 进入"我的"页面
   - 向下滚动到"专注历史"部分
   - 应该看到所有的会话记录（开始、中断、完成）

2. **检查统计数据**:
   - "今日专注": 应该显示今天的专注时长
   - "总完成": 应该显示完成的会话数
   - "成功率": 应该显示完成会话的百分比

3. **检查周统计图表**:
   - 应该显示过去7天的专注时长柱状图
   - 今天的数据应该显示在最右边

---

## 🔍 调试页面

如果需要调试钱包连接或余额显示，可以访问:

**http://localhost:3000/debug**

这个页面会显示:
- 钱包连接状态
- 当前地址
- 链ID
- ETH余额
- FOCUS余额
- USDC余额
- 合约地址

---

## 📝 预期结果

### 余额显示
- ✅ 顶部显示: `2000.00 FOCUS`
- ✅ "我的"页面显示: `2000 FOCUS 代币`
- ❌ **不应该**显示科学计数法
- ❌ **不应该**显示异常大的数字

### 会话功能
- ✅ 能够成功创建专注会话
- ✅ 能够中断会话并扣除费用
- ✅ 能够完成会话并获得奖励
- ✅ 所有交易都能在"专注历史"中显示

### 历史记录
- ✅ 显示所有会话事件（开始、中断、完成）
- ✅ 每条记录包含详细信息（时间、金额、交易哈希）
- ✅ 交易哈希可以复制
- ✅ 统计数据正确更新

---

## 🐛 常见问题

### 问题1: 余额显示为0或不正确
**解决方案**:
1. 检查钱包是否连接到正确的网络（Anvil Local, Chain ID: 31337）
2. 检查连接的钱包地址是否正确
3. 访问调试页面检查详细信息
4. 刷新页面重新读取余额

### 问题2: 交易失败
**解决方案**:
1. 检查Anvil是否正在运行: `ps aux | grep anvil`
2. 检查ETH余额是否足够支付gas费
3. 检查MetaMask中的gas设置
4. 查看浏览器控制台的错误信息

### 问题3: 历史记录不显示
**解决方案**:
1. 等待几秒钟，让事件监听器获取数据
2. 刷新页面重新加载历史记录
3. 检查浏览器控制台是否有错误
4. 确认交易已经成功上链

### 问题4: MetaMask无法连接
**解决方案**:
1. 确保Anvil正在运行
2. 在MetaMask中添加自定义网络:
   - 网络名称: Anvil Local
   - RPC URL: http://127.0.0.1:8545
   - 链ID: 31337
   - 货币符号: ETH
3. 导入测试账户私钥

---

## 📞 需要帮助？

如果遇到任何问题，请提供以下信息:
1. 具体的错误信息或截图
2. 浏览器控制台的日志
3. MetaMask中的交易详情
4. 连接的钱包地址
5. 执行的操作步骤

---

## 🎉 测试完成检查清单

- [ ] 余额显示正确（2000.00 FOCUS）
- [ ] 成功创建专注会话
- [ ] 成功中断会话并扣除费用
- [ ] 成功完成会话并获得奖励
- [ ] 历史记录正确显示所有事件
- [ ] 统计数据正确更新
- [ ] 交易哈希可以复制
- [ ] 所有UI交互流畅

完成所有测试后，请告诉我测试结果！

