# ZK Flex - 运行指南

> **你的钱包地址**：
> - Bob_real:  `0x15AfABaA426334636008Bc15805760716E8b5c5E`（要证明的地址）
> - Bob_proxy: `0xBA699556d41CD93e794952Bf1476ce9069b1EA03`（发交易用）
> - Alice:     `0x332772fce634D38cdfC649beE923AF52c9b6a2E5`（验证者）

---

## 🚀 快速启动（开发模式）

### 第 1 步：启动链

```bash
# Terminal 1
cd ~/ethshanghai/zk-flex
yarn chain

# 等待：Listening on 127.0.0.1:8545
# ✓ 保持运行
```

### 第 2 步：部署合约并转账

```bash
# Terminal 2
cd ~/ethshanghai/zk-flex/packages/foundry

# 设置你的地址
export BOB_REAL_ADDRESS=0x15AfABaA426334636008Bc15805760716E8b5c5E
export BOB_PROXY_ADDRESS=0xBA699556d41CD93e794952Bf1476ce9069b1EA03
export ALICE_ADDRESS=0x332772fce634D38cdfC649beE923AF52c9b6a2E5

# 1. 给你的地址转账（真正的链上转账！）
forge script script/FundAccounts.s.sol \
  --private-key 0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80 \
  --rpc-url http://localhost:8545 \
  --broadcast

# 看到：
# [OK] Transferred 100 ETH to Bob_real: 0x15AfA...
# [OK] Transferred 50 ETH to Bob_proxy: 0xBA699...
# [OK] Transferred 10 ETH to Alice: 0x33277...
# Funding complete! Check MetaMask.

# 2. 部署合约
forge script script/Deploy.s.sol \
  --private-key 0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80 \
  --rpc-url http://localhost:8545 \
  --broadcast

# 3. 生成前端 ABI（重要！）
node scripts-js/generateTsAbis.js

# ✓ 现在 MetaMask 里能看到 ETH 了！

# 📋 记下 Instance 地址（从 DemoSimple 输出）
# 例如：Instance: 0x9A9f2CCfdE556A7E9Ff0848998Aa4a0CFD8863AE
```

### 第 3 步：启动前端

```bash
# Terminal 3
cd ~/ethshanghai/zk-flex
yarn start

# 等待：ready - started server
# ✓ 访问 http://localhost:3000
```

**⚠️ 使用前端**：
1. 在 Bob 页面创建实例后
2. 从 Terminal 2 复制 Instance 地址
3. 粘贴到 Step 2 的 "Instance Address" 输入框
4. 等待 "Snapshot Found!" 显示
5. "Generate ZK Proof" 按钮变为蓝色（可点击）

---

## 🎬 Hackathon Demo（生产模式 - 推荐）

### Pitch 前 1 天准备

```bash
# 一次性构建（2-3 分钟）
cd ~/ethshanghai/zk-flex/packages/nextjs
yarn build

# ✓ 所有页面预编译完成
```

### Pitch 前 5 分钟

```bash
# Terminal 1: 启动链
yarn chain

# Terminal 2: 部署合约（同上）
cd packages/foundry
export BOB_REAL_ADDRESS=0x15AfABaA426334636008Bc15805760716E8b5c5E
export BOB_PROXY_ADDRESS=0xBA699556d41CD93e794952Bf1476ce9069b1EA03
export ALICE_ADDRESS=0x332772fce634D38cdfC649beE923AF52c9b6a2E5
forge script script/Deploy.s.sol --private-key 0xac09... --rpc-url http://localhost:8545 --broadcast
node scripts-js/generateTsAbis.js
forge script script/DemoSimple.s.sol --private-key 0xac09... --rpc-url http://localhost:8545 --broadcast

# Terminal 3: 启动前端（生产模式）
cd ~/ethshanghai/zk-flex
yarn start  # 自动使用 build 版本

# ✓ 所有页面秒开，无延迟！
```

**✅ 生产模式优势**：
- 所有页面已预编译
- 访问速度 <1 秒
- 无需预热
- 适合演示

---

## 📋 访问地址

```
Landing Page: http://localhost:3000
Bob 页面:     http://localhost:3000/zk-flex/bob
Alice 页面:   http://localhost:3000/zk-flex/alice
Debug 页面:   http://localhost:3000/debug
```

---

## ⚠️ 常见问题

### Q: 页面加载慢？

**A: 开发模式按需编译**
- 首次访问编译（10-20秒）
- 解决：使用生产模式（`yarn build` + `yarn start`）

### Q: Connection refused?

**A: 链未启动**
```bash
# 确保 Terminal 1 显示：
Listening on 127.0.0.1:8545

# 测试：
curl http://localhost:8545
```

### Q: 找不到合约？

**A: ABI 未生成**
```bash
cd packages/foundry
node scripts-js/generateTsAbis.js

# 重启前端：
cd ~/ethshanghai/zk-flex
# Ctrl+C 停止
yarn start
```

---

## 🎯 推荐流程（Hackathon）

```
提前 1 天：
  cd packages/nextjs && yarn build

Pitch 前 5 分钟：
  Terminal 1: yarn chain
  Terminal 2: 部署 + generateTsAbis + Demo
  Terminal 3: yarn start（生产模式）

Pitch 时：
  所有页面秒开 ✨
```

---

**就这么简单！** 🎉
