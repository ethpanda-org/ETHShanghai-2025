# VaultCraft 产品文档（PRD）v0

面向黑客松的最小可行版本，锚定 HyperVault 的成熟交互与规则，核心在于“与 Hyper 同等顺滑的公募体验 + 新增私募/KOL 场景（投前摘要、投后不披露持仓，仅披露 NAV/PnL 曲线）”。所有复杂机制（锁期费曲线、Reduce-Only、容量定价、批量窗口、私有路由、AA、复杂风控、期权/RWA 等）均延后，记录在文末 Backlog 以便后续评审逐步纳入。

---

## 1. 概述与目标

- 一句话：可验证的人类交易员金库平台，v0 保持与 HyperVault 相近的“公募金库透明、易用”的体验，同时提供“私募金库（白名单/不公开持仓，投后仅披露 NAV/PnL 曲线）”，叙事为“比 Hyper 多私域流量，比带单更规范更安全”。
 - 演示链：HyperEVM 测试网（chainId 998）优先；保持 Router/Adapter 与事件/快照口径稳定，可在其它链重放。
- 可见性：默认隐藏 AUM 小于阈值的小金库（可在前端切换显示全部）。
- 非目标（v0）：不做复杂锁期费曲线、不做 Reduce-Only、不做容量/拥挤函数、不做批量申赎窗口、不做私有路由/AA、不做跨链、不做期权/RWA、不过度风控。

---

## 2. 锚点对比（HyperVault vs VaultCraft v0）

- 可直接借鉴（保持一致）
  - 公募金库：持仓与交易透明，净值/累计 PnL 直接展示；用户按份额申赎。
  - 绩效分成：采用高水位线（HWM）的绩效费 p（默认 10%），与 Hyper 的“只对超额抽成”一致。
  - 经理自投：推荐自投比例 ≥5%（可配参数 `min_manager_stake_ratio`）。
  - 经理无提币权：经理只能在白名单资产内调仓，不能提走用户本金。

- 我们的 v0 差异（仅保留必要“私募”能力）
  - 私募金库：投前仅展示摘要指标（年化/波动/回撤/Sharpe），入场后仅披露 NAV/PnL 曲线，不披露持仓与交易明细。后续可结合 WhisperFi 等实现交易活动隐私（MVP 不启用，仅预留接口）。
  - 小金库隐藏：默认在发现页隐藏 AUM 小于阈值的金库，避免噪音与滥建；无金库创建费。
  - 统一抽象以便后续迁移：Router/Adapter 统一出入，未来可无痛对接 HyperEVM/多家 perps。

---

## 3. 角色与价值主张

- 投资者
  - 目标：省时间、拿策略收益、退出公平、报表透明。
  - 价值：比带单更一致（份额化会计），比 Hyper 多“私募通道”的可选性。

- 经理/KOL
  - 目标：获得私域 AUM、保护执行隐私（投前不泄露）、流程规范、分润清晰。
  - 价值：在不损失 Hyper 公募顺滑体验下，额外获得“白名单私募视图”的增长工具。

- 平台
  - 目标：安全可审计、易于上新与迁移、增长质量可衡量。
  - 价值：极简内核 + 明确 Backlog，黑客松可快速交付演示。

---

## 4. v0 范围（功能清单）

- 金库类型：Public（公开透明）与 Private（白名单/不公开持仓）。
- 资产白名单：仅允许列名资产/协议交互（现货 DEX 与 1 条 perps）。
- 份额申赎：实时申购/赎回（不做批量窗口），固定最短锁定期（例如 1 天，可配）。
- 绩效费（HWM）：仅当单位净值创新高时抽成（默认 10%）。
- 管理费：v0 设为 0（后续可开关）。
- 透明度：
  - Public：持仓/交易实时可见（与 Hyper 一致）。
  - Private：投前仅摘要；入场后不披露持仓/交易，仅披露 NAV/PnL 曲线与绩效指标。
- 可见性：默认隐藏 AUM < 阈值金库；支持“显示全部”。
- 基础安全：经理无提币权、资产白名单、合约可暂停（Pausable）。

---

## 5. 用户流程（按身份）

- 投资者（Public）
  - 浏览发现页 → 选择金库 → 查看持仓/交易/净值 → 选择申购金额 → 立即按当前净值铸份额 → 持有 → 赎回按份额×当前净值到账。

- 投资者（Private）
  - 浏览发现页（仅摘要）→ 申请加入或白名单验证 → 入场后查看 NAV/PnL 曲线（不公开持仓/交易）→ 申购/持有/赎回流程同上。

- 经理/KOL
  - 创建金库 → 配置资产白名单、参数（锁定期、绩效费 p、自投地址）→ 存入自投资金（≥5% 推荐）→ 公募或私募招募 → 在白名单资产内调仓 → 披露（Public 实时、Private 延迟/投后）。

- 平台
  - 审核金库参数（轻）→ 上线发现页（默认隐藏小金库）→ 监控异常并可暂停 → 收集最小指标用于展示。

---

## 6. 资金与会计（每一分钱的去向）

- 记号
  - `A_t`：资产可实现价值；`L_t`：负债（v0 预计为 0）；`S_t`：总份额；`PS_t = (A_t − L_t) / S_t`：单位净值。
  - `p`：绩效费率（默认 10%）；`HWM_t`：历史单位净值高点。

- 申购（无入场费）
  - 用户投入 `M`（稳定币）。
  - 铸份额：`ΔS_dep = M / PS_before`。
  - 资产变化：`A_{t+} = A_t + M`；`S_{t+} = S_t + ΔS_dep`；净值 `PS` 不因申购改变。

- 赎回（无退出费）
  - 用户赎回份额 `X`。
  - 到手：`Payout = X * PS_before`。
  - 销毁份额：`ΔS_red = X`；资产变化：`A_{t+} = A_t − Payout`；净值 `PS` 不因赎回改变。

- 绩效费（HWM，铸份额支付）
  - 当 `PS_t > HWM_t`：
    - 超额资产：`perfAssets = (PS_t − HWM_t) * S_t * p`
    - 铸份额：`ΔS_perf = perfAssets / PS_t`
    - 更新：`HWM_{t+} = PS_t`，`S_{t+} = S_t + ΔS_perf`
  - 解释：不动用户资产，按份额稀释支付绩效费，链上可审计。

- 管理费
  - v0 为 0（后续可选开启按天线性铸份额计提）。

- 舍入与精度
  - 份额以固定小数位（如 18 位）计；铸造/销毁按“向下取整”避免凭空增益；累计误差以事件日志可核对。

---

## 6A. 参数与治理矩阵（Config Matrix）

说明：列出关键参数的定义、默认值、范围与治理归属，标注哪些为 v0 常量，哪些可热更新，哪些计划交由 DAO 管理。

- 全局/平台级参数
  - `chain_id`：演示链网络 ID（默认 Base Sepolia，可换 Arbitrum Sepolia）。治理：平台。热更新：是。
  - `aum_hidden_threshold_usd`：发现页隐藏 AUM 低于该阈值的金库（默认 10,000）。治理：平台。热更新：是。
  - `precision_decimals`：份额/会计精度（默认 18）。治理：平台。热更新：否（部署常量）。

- 金库级参数（Vault Config）
  - `performance_fee_p`：绩效费率（默认 0.10；范围 0–0.30）。治理：经理提案、平台批准。热更新：是（上链事件）。
  - `management_fee_m`：管理费年化（默认 0；范围 0–0.05）。治理：经理提案、平台批准。热更新：是。
  - `lock_min_days`：最短锁定天数（默认 1；范围 0–7）。治理：经理。热更新：是。
  - `min_manager_stake_ratio`：经理自投推荐比例（默认 0.05）。治理：平台。热更新：是（v0 软约束；v1+ 可转硬约束影响 AUM 上限）。
  - `assets_whitelist`：可交互资产/协议地址列表。治理：平台（安全基线）。热更新：是（变更记事件）。
  - `visibility`：是否公开展示（Public 默认显示，Private 默认隐藏；小金库隐藏规则叠加）。治理：平台/经理。热更新：是。
  - `privacy_mode`：执行/披露隐私模式（v0=`none`；v1+ 预留 `whisperfi`/`delayed_disclosure`）。治理：经理提案、平台批准。热更新：是。
  - `metrics_window_days`：指标统计窗口（默认 90 天；年化按 365 天）。治理：平台。热更新：是。

- 指标与曲线口径
  - 日收益 `r_d`：按单位净值日度变动：`r_d = (PS_d / PS_{d-1}) − 1`；缺失日用最近有效净值前向填充。
  - 年化收益：`(Π_d (1+r_d))^(365/N) − 1`，N 为有效天数（可配置窗口）。
  - 年化波动：`std(r_d) * sqrt(365)`（样本标准差；可选 1–5% Winsorize 去极值）。
  - Sharpe：`(年化收益 − r_f) / 年化波动`；v0 取无风险利率 `r_f=0`（可配置）。
  - 最大回撤/恢复期：基于净值曲线；回撤为峰-谷相对跌幅，恢复期为回到峰值所用天数。

- 会计不变量/规则
  - 存取款不改变单位净值 `PS`；资产价格/仓位变动与费用铸份额才影响 `PS`/`S`。
  - 绩效费仅在 `PS > HWM` 时计提，按铸份额支付，不直接动用户资产；变更费率需上链事件。
  - 参数更新均记录事件，便于审计与本地复算；v0 可无时间锁，后续移交 DAO 并加时间锁。

---

## 7. 金库类型与可见性规则

- Public Vault
  - 持仓/交易：实时可见；
  - 锁定：固定最短锁定期（例如 1 天，可配）；
  - 搜索可见：默认显示；
  - AUM 太小：若低于阈值，可在列表尾部或归类“新建/小型”。

- Private Vault
  - 投前可见：仅摘要指标（收益、波动、回撤、Sharpe、AUM、经理自投比例）。
  - 投后展示：仅 NAV/PnL 曲线与绩效指标，不披露持仓与交易明细；无 T+N 解锁。
  - 加入方式：白名单地址或签名门票（由经理发放或平台审核）。
  - 搜索可见：默认隐藏（仅持有者/白名单可见）。

---

## 8. 透明度与披露（v0）

- 公募（金库页）
  - 实时持仓（资产构成/权重）、最近交易、净值/累计 PnL 曲线、Sharpe/最大回撤等摘要。

- 私募
  - 投前：仅摘要（不含交易明细与实时持仓细节）。
  - 投后：不披露持仓/交易，仅展示 NAV/PnL 曲线与绩效指标；无 T+N 解锁。
  - 合成 NAV 承诺：当使用外部场所（例如 Hyper Testnet）镜像执行时，资金仍托管在链上 Vault；后端按固定口径（指数价）计算 NAV，并记录快照与承诺（Merkle root 可选上链）。
  - 执行隐私：v0 不做交易隐私；后续可结合 WhisperFi 提供私密执行/清白证明，保持会计与承诺可复核。

---

## 9. 资产与市场（v0 支持）

- 现货 DEX：稳定币与黄金类（PAXG/XAUT，如目标链流动性不足则以合成黄金替代）。
- Perps：v0 可先用“链上执行（适配器）”闭环演示；若测试网不可用，则采用“集中执行镜像”对接 Hyper Testnet API（资金不迁移，仅展示 NAV）。
- 价格：使用协议自带指数价/预言机作为展示与校验的基准（不做复杂价格带风控）。

---

## 10. 最小安全与治理（v0）

- 基线
  - 经理无提币权（仅投资者赎回路径可提取）；
  - 资产/协议白名单（仅 Router → Adapter 允许的交互）；
  - 可暂停（Pausable）：平台/守护地址可暂停交互以应对紧急情况；
  - 参数变更：轻量级时间锁（可选，v0 可直接治理调用并上链事件）。
  - 容量与限额：公募可配置 `max_total_assets` 与风险阈值（净敞口/杠杆/名义）；私募默认不设 cap。

- 延后不做（v0）
  - Reduce-Only 模式、价格带/公平价强约束、累计滑点预算、容量约束/拥挤折扣函数、批量窗口、私有路由/AA、经理质押与削减。

---

## 11. 指标与排行（v0）

- 展示：年化收益、年化波动、Sharpe、最大回撤、回撤恢复期、AUM。
- 私募投前：仅展示上述摘要；投后/公募：附持仓/交易明细与累计 PnL 曲线。

---

## 12. 测试网与迁移（HyperEVM）

- 演示链：HyperEVM 测试网为主；
- 迁移预留：
  - Router/Adapter 隔离具体协议地址；
  - 金库份额/NAV 快照/交易事件采用标准事件结构，便于在 HyperEVM 或其它链重放与对账；
  - Private 视图门控规则与签名门票逻辑链无关，可直接复用。

---

## 13. 集中执行与分摊（概述，详见 TECH_DESIGN）

- 模式 A（链上执行，v0 推荐闭环）：经理通过 Manager Console 调用 `vault.execute(adapter,data)`，由 Router→Adapter 与白名单协议交互。
- 模式 B（集中执行镜像，v1）：前端下单 → 后端 Exec Service 在 Hyper 以服务账户聚合下单 → 成交回报分摊到各 Vault 的订单 → 计算 NAV 并承诺。资金不迁移，Vault 仅作份额会计。

披露口径：公募展示持仓与交易；私募仅展示 NAV/PnL 与 KPI，指标与 NAV 口径与 TECH_DESIGN 保持一致。

---

## 14. 调研清单（Research TODO）

- 测试网选择与稳定性：Base Sepolia / Arbitrum Sepolia / 其他；预言机与 DEX/Perps 的可用性与部署脚本。
- PAXG/XAUT（现货）
  - 目标测试网是否有可用的代币/镜像与流动性；若无，评估使用合成黄金（Synthetix XAU）。
  - 价格基准：Chainlink 或协议指数价覆盖情况；回退策略。
- Perps（Synthetix 优先）
  - 目标测试网支持的市场清单、保证金资产、费率/资金费、清算参数。
  - 下单抽象：开/平仓、杠杆、Reduce 标志（v0 不启用 Reduce-Only，但接口预留）。
- 私募门控
  - 白名单地址 vs 签名门票（有效期、不可转让、吊销机制与 UX）。
  - 私募投后展示范围的合意性（仅 NAV/PnL 与绩效指标）。
- 指标口径
  - 年化/波动/Sharpe 的窗口配置（默认 90 天）；去极值策略是否启用。
  - 最大回撤与恢复期的计算与展示一致性。
- 小金库隐藏
  - AUM 阈值默认值（10,000）是否合适；是否对已持有者豁免隐藏。
- HyperEVM 迁移
  - 目标网络 RPC/预言机/DEX/perps 覆盖；Router/Adapter 地址映射与差异点清单。
  - 份额/HWM/NAV/事件快照格式与重放流程。
- WhisperFi 预留
  - 可稳定使用的子集、关键 bug 与 workaround；
  - 与 v1+ 的接口对接位置（下单/结算证明/清白证明）；v0 仅参数与数据模型预留。

## 13. 里程碑与验收（仅 v0）

- v0（黑客松提交）
  - Public/Private 金库创建/发现/详情页；
  - 白名单/门票（私募投前仅摘要、投后解锁）；
  - 申购/赎回（锁定期最小化、实时净值）；
  - 绩效费（HWM，默认 p=10%，管理费=0）；
  - 资产白名单与 Router/Adapter（现货 DEX + Synthetix Perps 其一）；
  - 默认隐藏小金库；
  - 指标与排行（摘要指标）；
  - 合约可暂停、基础事件日志；
  - Demo 剧本：创建金库→公募透明展示；创建私募→投前摘要→白名单入场→解锁明细→调仓→净值变化→赎回对账。

---

## 14. 非目标与边界（v0）

- 不做：锁期费曲线/动态费率、Reduce-Only、容量函数/等候队列、批量窗口、私有路由/AA、跨链、复杂衍生品（期权）、RWA 收益腿、经理质押与削减、复杂风控（价格带/滑点预算）。
- 说明：这些功能在 Backlog 中明确规格，待后续安全/体验评审后再择机纳入。

---

## 15. Backlog（延后功能规格占位）

- 锁期费率曲线：`f_in(T)` / `f_out(T)` 指数衰减，结合极端波动免收与冷却。
- Reduce-Only：异常触发后仅允许减仓，赎回不受限。
- 多市场适配器：Polymarket、美股、贵金属、期权等 venue 的 Router/Adapter，与 `venue_whitelist` / `risk_envelope` 一致。
- WhisperFi 私募增强：投前摘要、投后 NAV、交易隐私存证与稽核接口。
- Vault 组合器：允许新 Vault 选择现有 Vault 作为按比例建仓模块或自动化策略。
- 价格带 / 公平价 / 滑点预算：指数价 ± 带宽约束、滚动预算。
- Alert & Reporting：多语言（含中文）、告警订阅、Merke 承诺展示、评估日志。
- AA / Session Key：对 off-venue 执行账号限权（额度、频次、白名单地址）。
- 长期研究：跨链迁移、桥接、DAO 治理与参数时间锁（不在 v2 范围）。

---

## 16. 调研清单（Research TODO）

- 测试网选择与稳定性：Base Sepolia / Arbitrum Sepolia / 其他；部署与预言机可用性。
- PAXG/XAUT 在目标链的流动性与可交易性：
  - 可用 DEX 与池深度（Uniswap v3 / Curve 等）；
  - Chainlink 或协议指数价覆盖情况；
  - 若现货不足，合成黄金（Synthetix XAU）可替代性评估。
- Perps 接入：
  - Synthetix Perps（目标测试网的市场列表、保证金/费率、清算参数）；
  - 后续可接 Hyper/GMX/Vertex/Aevo 的 API/合约差异与抽象层设计点。
- 私募门控：
  - 白名单地址 vs 签名门票（有效期/转让性/吊销机制）；
  - 投后解锁延迟（T+1/T+3）的具体披露粒度与 UX。
- 指标口径：
  - 年化收益与波动的计算窗口、去极值策略；
  - 最大回撤/恢复期口径与可复算脚本。
- 默认隐藏小金库：
  - AUM 阈值默认值、前端切换 UX、是否对已持有者豁免隐藏。
- HyperEVM 迁移：
  - 目标网络 RPC/预言机/DEX/perps 覆盖；
  - Router/Adapter 的地址映射与差异点清单；
  - 数据快照格式与重放流程（份额/HWM/NAV/事件）。
- WhisperFi 预留：
  - 当前仓库可用子集、主要 bug、可稳定集成功能边界；
  - 与 v0 的接口对接位置（下单/结算证明/清白证明）。