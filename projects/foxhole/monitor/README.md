# Dex Screener Token Monitor

高性能的 Dex Screener token 数据监控工具，实时采集并存储 token 信息。

## 功能特点

- ⚡ **高性能**: 使用异步 HTTP 请求，支持每 0.1 秒采集一次数据
- 🔄 **智能去重**: 基于 token 符号和名称的快速去重机制
- 💾 **持久化存储**: 数据保存在 CSV 文件中，便于后续分析
- 📊 **实时统计**: 实时显示采集统计信息
- 🛡️ **稳定可靠**: 完善的错误处理和优雅退出机制
- 🚀 **内存优化**: 使用 LRU 缓存限制内存使用

## 系统要求

- Python 3.7+
- 稳定的网络连接

## 安装

1. 进入 monitor 目录：
```bash
cd monitor
```

2. 安装依赖：
```bash
pip install -r requirements.txt
```

## 使用方法

### 启动监控

```bash
python token_monitor.py
```

### 停止监控

按 `Ctrl + C` 优雅地停止监控程序。

## 配置说明

编辑 `config.py` 文件可以修改以下配置：

### API 配置
- `API_BASE_URL`: Dex Screener API 基础 URL
- `API_ENDPOINTS`: API 端点配置

### 采集配置
- `FETCH_INTERVAL`: 采集间隔（默认 0.1 秒）
- `REQUEST_TIMEOUT`: 请求超时时间（默认 5 秒）

### CSV 配置
- `CSV_FILE`: CSV 文件名（默认 "tokens_data.csv"）
- `CSV_HEADERS`: CSV 列名

### 性能配置
- `CACHE_SIZE`: 内存缓存大小（默认 10000）

## 数据格式

CSV 文件格式：

| token_symbol | token_name | timestamp |
|--------------|------------|-----------|
| BTC | Bitcoin | 2025-10-19T12:30:45.123456 |
| ETH | Ethereum | 2025-10-19T12:30:45.234567 |

- **token_symbol**: Token 符号
- **token_name**: Token 名称
- **timestamp**: 数据采集时间（ISO 8601 格式）

## 性能指标

- 采集频率: 每秒最多 10 次请求
- 去重速度: O(1) 时间复杂度
- 内存使用: 缓存限制在 10000 个 token
- CSV 写入: 批量追加模式，高效写入

## 日志

程序会生成两种日志：
1. **控制台输出**: 实时显示运行状态
2. **日志文件**: `monitor.log` 记录详细信息

日志包含的信息：
- API 请求统计
- 新增 token 数量
- 重复数据统计
- 错误信息

## 注意事项

1. **API 限制**: Dex Screener API 可能有速率限制，建议不要设置过短的采集间隔
2. **磁盘空间**: 长期运行会产生大量数据，请确保有足够的磁盘空间
3. **网络稳定性**: 需要稳定的网络连接，程序会自动处理网络错误
4. **数据完整性**: 程序异常退出时，CSV 文件中的数据不会丢失

## 故障排除

### 问题: 无法连接到 API

**解决方法**:
- 检查网络连接
- 验证 API URL 是否正确
- 检查防火墙设置

### 问题: CSV 文件权限错误

**解决方法**:
- 确保当前用户有写入权限
- 检查磁盘空间是否充足

### 问题: 内存使用过高

**解决方法**:
- 减少 `CACHE_SIZE` 配置值
- 定期清理旧的 CSV 数据

## 技术架构

### 核心技术
- **aiohttp**: 异步 HTTP 客户端
- **asyncio**: 异步 I/O 框架
- **csv**: 标准库 CSV 处理
- **set**: 高效去重数据结构
- **deque**: 限制大小的缓存队列

### 设计模式
- 单例模式（TokenMonitor 类）
- 生产者-消费者模式（数据采集与存储）
- 观察者模式（信号处理）

### 性能优化
1. **异步请求**: 非阻塞 I/O 操作
2. **集合去重**: O(1) 查找时间复杂度
3. **批量写入**: 减少磁盘 I/O 次数
4. **内存限制**: 使用 deque 限制缓存大小
5. **优雅关闭**: 处理系统信号，确保数据完整性

## 扩展建议

1. **多链支持**: 可以扩展支持多个区块链的 token 监控
2. **数据分析**: 可以添加数据分析模块，发现热门 token
3. **告警功能**: 可以添加特定条件的告警通知
4. **数据库支持**: 可以将 CSV 改为数据库存储，支持更复杂的查询
5. **Web 界面**: 可以开发 Web 界面实时查看监控数据

## 许可证

MIT License

## 联系方式

如有问题或建议，请提交 Issue。

