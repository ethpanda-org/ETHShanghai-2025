# 一步到位杠杆开仓功能更新

## 概述
根据用户需求，已成功修改交易逻辑，实现一步到位的杠杆开仓流程。用户现在可以使用WRMB购买WBTC，并通过闪电贷实现杠杆交易。

## 主要修改内容

### 1. 代币地址配置更新 (`lib/position.ts`)
- 添加了新的代币支持：
  - `WBTC`: `0x29f2D40B0605204364af54EC677bD022dA425d03` (Sepolia测试网)
  - `WRMB`: `0x7257122CAC1E7D58CB3768Acb7A0aBA66a0c162D` (客户初始资金地址)
  - `USDT`: `0x29f2D40B0605204364af54EC677bD022dA425d03` (Sepolia测试网)

### 2. 新增交易逻辑
- 添加了 `LeverageOpenPositionParams` 类型定义
- 实现了 `openLeveragePosition` 函数，支持一步到位杠杆开仓
- 保留了原有的传统开仓功能

### 3. 一步到位杠杆开仓流程
1. **用WRMB买WBTC**（自有本金）
2. **闪电贷临时借入更多WBTC**
3. **把「自有WBTC + 闪电贷WBTC」一起存入金库作抵押，铸出FXUSD**
4. **卖出FXUSD → USDC → 买WBTC**
5. **用这部分买到的WBTC归还闪电贷（含手续费）**
6. **交易结束**：闪电贷已清零，金库里留下更多的WBTC作为抵押，账户背上FXUSD债务

### 4. 前端界面更新 (`components/OpenPositionButton.tsx`)
- 添加了交易模式选择（一步到位杠杆开仓 vs 传统开仓）
- 新增了WRMB和WBTC数量输入字段
- 添加了详细的流程说明
- 保持了原有的传统开仓功能

### 5. 技术实现细节
- 使用 `openOrAddPositionFlashLoanV2` 函数实现闪电贷开仓
- 支持WBTC作为抵押物
- 支持FXUSD作为债务代币
- 集成了DEX交换功能（可扩展）

## 使用方法

### 一步到位杠杆开仓
1. 选择"一步到位杠杆开仓"模式
2. 输入WRMB数量（例如：1000）
3. 输入目标WBTC数量（例如：0.1）
4. 设置杠杆倍数（例如：3.0）
5. 点击"一步到位杠杆开仓"按钮

### 传统开仓
1. 选择"传统开仓"模式
2. 输入stETH抵押物数量
3. 设置杠杆倍数
4. 点击"传统开仓"按钮

## 配置的地址
- **WRMB客户初始资金地址**: `0x795751385c9ab8f832fda7f69a83e3804ee1d7f3`
- **Sepolia测试网WBTC地址**: `0x29f2D40B0605204364af54EC677bD022dA425d03`
- **Sepolia测试网FXUSD**: `0x085a1b6da46ae375b35dea9920a276ef571e209c`
- **Sepolia测试网USDC/USDT地址**: `0x29f2D40B0605204364af54EC677bD022dA425d03`

## 注意事项
1. 确保在Sepolia测试网上进行测试
2. 需要足够的WRMB余额进行交易
3. 闪电贷需要支付手续费
4. 建议在测试环境中充分测试后再部署到主网

## 下一步优化建议
1. 添加价格预言机集成
2. 优化滑点保护机制
3. 添加更多DEX路由支持
4. 实现动态手续费计算
5. 添加交易历史记录功能
