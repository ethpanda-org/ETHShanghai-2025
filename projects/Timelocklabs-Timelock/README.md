# TimeLock - ETHShanghai 2025

> 一站式 TimeLock 合约管理与监控平台，为 DeFi 协议和 DAO 治理提供安全防护

## 一、项目概述

### 项目名称

**TimeLock** - 区块链时域缓冲安全解决方案

### 一句话介绍

为 DeFi 协议和 DAO 组织提供 TimeLock 合约的统一管理、实时监控和智能通知的企业级安全解决方案。

### 什么是 TimeLock？

TimeLock（时间锁）是一种安全机制，其设计理念源于：

- **资金安全：银行金库** 🏦
    - 重形结构与材料：多重锁机制（多签钱包）
    - 安防系统集成：时间锁系统（Timelock合约）

- **权限安全：炸弹/核武器** 💣
    - 物理与环境安全：双钥匙，多重通讯原则（多签钱包）
    - 安防系统集成：延迟执行（时间锁）机制（Timelock合约）

**TimeLock 为关键操作设置强制审查期**，期间可审计、取消交易，并告警通知相关联络人，审查流程结束后方可执行，有效防止即时执行交易的攻击。

### 谁在使用 TimeLock？

行业领先的 DeFi 协议都在使用 TimeLock 保护其核心资产和治理流程：

- **DeFi 协议**：Compound、Uniswap、Aave、Synthetix、Yearn
- **流动性协议**：LIDO、Pendle
- **Layer2 方案**：EigenLayer、Ethena
- **DAO 组织**：MakerDAO 及众多去中心化治理组织

### 真实安全事件

| 事件                            | 损失                    | 如何通过 TIMELOCK 预防                            |
| ------------------------------- | ----------------------- | ------------------------------------------------- |
| **BITFINEX 私钥被盗** (2016)    | 💰 12.4万BTC (7千万美元) | 资金提取时间锁+多渠道警报，为团队提供足够应对时间 |
| **HARMONY 桥攻击** (2022)       | 💰 1亿美元               | 大额跨链转账强制延迟，跨链验证人变更安全审计      |
| **BYBIT 冷钱包多签劫案** (2025) | 💰 40万ETH (15亿美元)    | 多签数据变更时间锁，自动风险评估和异常行为检测    |

### 目标用户

**01 DeFi 协议**

- 协议参数调整保护 – 确保每次更改经过充分验证
- 智能合约升级安全网 – 代码变更的最后防线
- 紧急暂停功能防护 – 平衡快速响应与安全验证

**02 多签钱包用户**

- 大额转账防护屏障 – 金额越大，审查越严格
- 定期操作智能规划 – 自动化与安全的完美结合

**03 DAO 治理**

- 提案执行安全保障 – 防止恶意提案闪电执行
- 资金库管理保护 – 大额支出强制冷静期
- 成员权限变更控制 – 权限变更不再是安全软肋

**04 跨链桥**

- 大额跨链转账审核 – 跨链操作的额外保障
- 验证人集合变更保护 – 防止验证人被恶意替换

#### 核心问题与动机

当前缺乏执行层，用户操作管理困难，缺乏 TimeLock 套件守护安全：

- ❌ **仪命令行操作** - 技术门槛高，普通用户难以使用
- ❌ **需自建索引系统** - 缺乏现成的交易监控方案
- ❌ **多链管理困难** - 跨链操作繁琐复杂
- ❌ **无异常检测** - 缺少智能风险识别
- ❌ **需手动解析上链参数** - Calldata 解读困难
- ❌ **缺乏审计记录** - 没有完整的操作日志

#### 解决方案

通过构建安全可信赖的 TimeLock 执行层，提高 TimeLock 普及率，提升行业资金安全性：

✅ **多渠道实时提醒** - 确保关键操作不被忽视

- Email、Telegram、Lark、Feishu 等全渠道覆盖
- 状态变化即时推送（Waiting → Ready → Executed）

✅ **直观界面设计** - 降低安全操作门槛

- 可视化 Flow 状态展示
- 友好的参数解析和展示

✅ **自动参数解析** - 所有操作链上记录，实时监管每一步

- 智能 Calldata 解析引擎
- 自定义 ABI 支持
- 函数调用可视化

✅ **多链全覆盖** - 支持多链架构、智能异常检测、支持接入审计机构

- 以太坊、BSC、Polygon、Arbitrum、Optimism、Avalanche 等主流链
- 统一管理界面

## 二、架构与实现

### 系统架构总览

```
┌─────────────────────────────────────────────────────────────────┐
│                    前端应用层 (Frontend Layer)                    │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │ Safe钱包登录  │  │ 交易队列管理  │  │ 合约交互界面 │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
│  ┌──────────────┐                                               │
│  │ 通知设置中心  │           事件触发                             │
│  └──────────────┘                                               │
└───────────────────────────────┬─────────────────────────────────┘
                                │ REST API
                                │
┌───────────────────────────────▼─────────────────────────────────┐
│                     后端服务层 (Backend Services)                │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │            API网关服务 | 合约监听服务                      │  │
│  └──────────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │            参数解析引擎 | 通知分发系统                     │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                  │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐         │
│  │   用户数据库   │  │  合约数据缓存  │  │ 事件日志库   │         │
│  │   区块链事件   │  │    存储事件   │  │  速取缓存    │         │
│  └──────────────┘  └──────────────┘  └──────────────┘         │
└───────────────────────────────┬─────────────────────────────────┘
                                │
              ┌─────────────────┼─────────────────┐
              │                 │                 │
      ┌───────▼──────┐   ┌─────▼──────┐   ┌─────▼──────┐
      │ 区块链网络层  │   │   数据库    │   │ 通知渠道   │
      │ 以太坊/BSC/  │   │ PostgreSQL │   │Email/TG/   │
      │ Polygon等    │   │            │   │Lark/Feishu │
      └───────────────┘   └─────────────┘   └────────────┘
```

### 用户操作流程

```
项目管理员 → 1️⃣ 提交操作 → 2️⃣ 参数解析 → 3️⃣ 风险评估 → 4️⃣ 延时等待 → 5️⃣ 执行操作 → 6️⃣ 结果通知
     │              │              │              │              │
     │              ├─关联→ 合约交互模块          │              │
     │              │         ├─ 交易构建器       │              │
     │              │         ├─ 多链支持适配器   │              │
     │              │         └─ ABI 管理器       │              │
     │              │                             │              │
     │              └─关联→ 交易解析与通知模块 ←───┘              │
     │                       ├─ 队列参数解析引擎                 │
     │                       ├─ 行为监听引擎                     │
     │                       └─ ABI 风险评估与通知系统           │
     │                                                           │
     └────────────────关联→ 时间锁核心模块 ←─────────────────────┘
                            ├─ 延迟算法引擎
                            ├─ 队列管理器
                            └─ 紧急撤销机制
```

### 合约执行逻辑

**执行队列池**：项目管理员发起交易后，进入以下流程：

1. **Transaction 0x1** - 取消交易 → 交易废弃池
2. **Transaction 0x2** - 逾期未执行 → 保持在废弃池
3. **Transaction 0x3** - 到期执行 → 交易执行池
4. **Transaction 0x4** - 排队中，等待时间锁到期

### 关键模块详解

#### 🔐 合约交互模块

**多链适配器**

- 跨链管理解决方案，支持在单一平台管理多条区块链上的 TimeLock
- 统一界面预览与管理多链 TimeLock 的权限、资产与交易队列
- 为多链部署的 DeFi 项目提供无缝集成体验

**ABI 管理器**

- 智能 ABI 缓存系统，消除重复复制粘贴的繁琐操作
- 便捷的 ABI 导入、存储与调用功能，简化合约交互过程
- 提升操作效率，降低技术门槛，优化整体用户体验

**交易构建器**

- 简化复杂的交易编码流程，提供直观的参数编解码可视化界面
- 自动处理时间戳转换、参数格式规范与编码等技术难点
- 一站式解决方案：从交易构建到上链执行，全流程支持

#### 📊 交易解析与通知模块

**01 - 队列参数解析引擎**

- 智能解析 Timelock 队列中的交易数据，将技术参数转化为直观可读格式
- 双模式显示：既提供人类可读的解析结果，也保留原始 calldata 以供技术审计
- 大幅降低审计复杂度，提升操作透明度与安全性

**02 - 行为监听引擎**

- 实时监控关键链上行为，自动识别高风险操作
- 智能标记大额转账、敏感权限变更等重要操作，提供多重确认机制
- 主动防御系统，在潜在风险操作执行前预警，保障资产安全

**03 - 风险评估与通知系统**

- 多维度风险评估机制，综合分析参数风险、执行链包安全性及可疑地址识别
- 集成黑客地址库与智能合约漏洞检测工具，提供全方位安全防护
- 自动邮件通知系统，将关键操作实时推送至指定邮箱，确保团队及时响应

#### ⏰ 时间锁核心模块

**延迟算法引擎** ⏱️

- 集成业界领先的 Timelock 合约标准，提供经 Compound 和 OpenZeppelin 充分验证的延迟执行机制
- 灵活配置延迟参数，实现精确的治理时间控制与安全防护
- 确保关键操作有足够的公示期，平衡效率与安全需求

**队列管理器** 📋

- 实时监控并可视化展示链上交易状态，自动分类管理所有 Timelock 交易
- 五状态智能分类系统：排队中、待执行、已取消、已执行、已过期
- 直观界面展示交易生命周期，简化复杂队列管理流程，提升运营效率

**紧急撤销机制** 🚨

- 一键式交易撤销功能，为排队中和待执行的交易提供即时干预能力
- 快速响应机制，在发现误操作或安全威胁时立即采取行动
- 多层次安全防护，有效降低人为错误和恶意攻击的风险，保障资产安全

#### 技术栈

**前端技术栈**

- **基础框架**: Next.js 15（App Router）+ React 19 + TypeScript
- **Web3 集成**: thirdweb/react（配合 ThirdwebProvider）、thirdweb ethers5 适配器、ethers.js v5
- **状态管理**: @tanstack/react-query 负责异步数据；zustand（含 persist 中间件）保存应用与偏好状态
- **UI 体系**: Tailwind CSS（v4 配置）+ shadcn/ui 组件集合（基于 Radix UI primitives）+ lucide-react 图标
- **构建与工具链**: Next.js 原生构建（开发模式启用 next dev --turbopack，生产使用 next build，依托 SWC/Turbopack 与 PostCSS 管线）

**后端技术栈**

- **语言与框架**：Go 1.23 + Gin Web Framework
- **数据库**：PostgreSQL + GORM ORM
- **区块链交互**：go-ethereum (Geth)
- **配置管理**：Viper
- **日志系统**：Zap
- **认证**：JWT (access token + refresh token)

**核心服务架构**

1. **扫链系统 (Chain Scanner Service)**
    - `ChainScanner`：单链扫描器，监听特定链的区块和事件
    - `Manager`：扫链管理器，协调多链扫描器生命周期
    - `RPCManager`：RPC 连接池管理，支持 Alchemy 等 RPC 提供商
    - `BlockProcessor`：区块处理器，解析交易和事件
    - `EventProcessor`：事件处理器，识别 TimeLock 事件
    - `FlowStatusRefresher`：定时刷新 Flow 状态（waiting → ready → expired）

2. **TimeLock 服务 (TimeLock Service)**
    - 支持 Compound 和 OpenZeppelin 标准
    - 从链上读取合约参数（delay, admin, grace period）
    - 自动刷新合约权限和配置
    - 权限验证（creator, admin, pending_admin）

3. **认证服务 (Auth Service)**
    - EOA 钱包签名认证（EIP-712）
    - Safe 多签钱包验证（链上查询 threshold 和 owners）
    - JWT Token 管理
    - Nonce 生成和防重放验证

4. **通知服务 (Notification & Email Service)**
    - **Email**：SMTP 发送，支持验证码和状态通知
    - **Telegram**：Bot API 消息推送
    - **Lark/Feishu**：Webhook 卡片消息
    - 通知去重、发送日志、失败重试

5. **Flow 管理服务 (Flow Service)**
    - 追踪 TimeLock 交易完整生命周期
    - 状态机：waiting → ready → executed/cancelled/expired
    - 关联交易记录（queue tx, execute tx, cancel tx）

6. **ABI 服务 (ABI Service)**
    - 用户自定义 ABI 管理
    - Calldata 解析和函数签名匹配
    - Function selector 验证

### 架构与安全设计

#### 架构安全

**前端安全设计**

1. ✅ **前端应用将部署于 IPFS 分布式存储网络**
    - 确保代码完整性与不可篡改性
    - 去中心化部署，提高可用性

2. ✅ **采用前后端分离的架构模式**
    - 后端通过直接扫描区块链获取交易日志
    - 提高数据可靠性和系统安全性

3. ✅ **智能合约采用业界认可的开源方案**
    - 使用 Compound 或 OpenZeppelin 的 TimeLock 合约
    - 经过市场验证，确保安全性与稳定性

#### 合约安全

**01 - 支持自主导入 Timelock 合约**

- 平台支持无缝对接现有 Timelock 合约
- 兼容 AAVE、Compound 和 OpenZeppelin 标准
- 已部署的合约可直接导入平台使用，无需重新部署
- 降低迁移成本与风险

**02 - 支持创建行业标准 Timelock 合约**

- 平台现阶段不独立开发 Timelock 合约
- 而采用已经过市场验证的 Compound 和多方审计的行业标杆 OpenZeppelin 合约
- 确保合约安全性和可靠性


#### 安全模块 - 高危操作警报

**01 - 大额资金异动警报** 💰

- 用户可配置 Timelock 对应每操作额度上限提醒
- 若操作额度超过上限，平台会发出重要提醒
- 提醒用户防范风险

**02 - 高危权限修改警报** ⚠️

- 平台会检测合约的所有权情况，当所有权发生变更时，平台将会发出提醒
- 与此同时用户也可以灵活配置 Timelock 合约执行时的 Target 合约的权限重点监控

## 三、运行与复现

### 前置要求

**后端环境**

- Go 1.23+
- PostgreSQL 14+
- Git

**前端环境**

- Node.js 22+
- pnpm (推荐) 或 npm

### 启动（本地示例）

**1. 启动后端**

```bash
cd back-end

# 安装依赖
go mod tidy

# 修改配置文件 config.yaml(rpc的key、数据库的密码、jwt的key、邮箱的应用密码)

# 启动服务
go run cmd/server/main.go

# 或编译后运行
go build -o timelock-server cmd/server/main.go
./timelock-server
```

后端服务将在 `http://localhost:8080` 启动

**2. 启动前端**

```bash
cd front-end

# 安装依赖
pnpm install

# 编译项目
npm run build

# 运行项目
npm run start
```

前端应用将在 `http://localhost:3000` 启动

## 四、团队与联系信息

邮箱 📧：gm@timelock.tech