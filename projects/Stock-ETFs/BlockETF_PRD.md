# BlockETF - 产品需求文档 (PRD)

## 1. 产品概述

### 1.1 产品定位
BlockETF是一个去中心化的链上ETF（交易所交易基金）协议，允许用户通过单一稳定币（USDT/USDC）申购多元化的加密资产组合，实现一键式分散投资。

### 1.2 目标用户
- **普通投资者**：希望简单配置加密资产组合，降低单一资产风险
- **机构投资者**：需要透明、可审计的链上资产管理工具
- **DeFi用户**：寻求被动投资策略，获得市场平均收益

### 1.3 核心价值
- **简化投资**：单币申赎，无需手动配置多种资产
- **透明可信**：所有操作链上可查，资产由智能合约托管
- **低门槛**：最小申购金额低，适合各类投资者
- **自动化管理**：智能合约自动执行再平衡策略

## 2. MVP功能需求

### 2.1 资产管理模块

#### 2.1.1 ETF创建与配置
- **功能描述**：管理员创建ETF产品，设定资产组合
- **具体需求**：
  - 设定ETF名称、代号（如：BTOP50）
  - 配置目标资产及权重（如：20% BTC, 20% ETH, 20% BNB, 20% XRP, 20% SOL）
  - 设置费率结构（如：申购费0%、赎回费0.5%、管理费2%年化）
  - 设置最小申购金额（如：100 USDT）
  - 设置再平衡触发条件（权重偏离度>5%）

#### 2.1.2 份额代币化
- **功能描述**：ETF份额以ERC20代币形式存在
- **具体需求**：
  - 符合ERC20标准，可自由转账
  - 份额精度：18位小数
  - 支持份额查询、转账历史记录

### 2.2 申购赎回模块

#### 2.2.1 单币申购
- **功能描述**：用户使用USDT/USDC申购ETF份额
- **操作流程**：
  1. 用户授权USDT/USDC给合约
  2. 输入申购金额
  3. 系统计算预估获得份额（扣除费用和滑点）
  4. 用户确认交易
  5. 合约自动通过DEX将USDT换成目标资产
  6. 铸造相应ETF份额给用户
- **技术要求**：
  - 滑点保护：最大滑点3%
  - Gas优化：批量交换，减少交易次数
  - 失败回滚：任一步骤失败，全部回滚

#### 2.2.2 单币赎回
- **功能描述**：用户销毁ETF份额，获得USDT/USDC
- **操作流程**：
  1. 用户输入赎回份额数量
  2. 系统计算预估获得USDT金额
  3. 用户确认交易
  4. 销毁用户的ETF份额
  5. 合约将对应比例的底层资产通过DEX换成USDT
  6. 将USDT转给用户
- **技术要求**：
  - 支持部分赎回
  - 紧急赎回模式（市场极端情况下直接返还底层资产）

### 2.3 定价与估值模块

#### 2.3.1 净值（NAV）计算
- **功能描述**：实时计算ETF净值
- **计算公式**：
  ```
  NAV = Σ(各资产数量 × 当前价格) / 总份额数
  ```
- **数据源**：
  - 主要：Chainlink价格预言机
  - 备用：Uniswap V3 TWAP
- **更新频率**：每个区块更新一次

#### 2.3.2 申赎定价
- **申购价格**：NAV × (1 + 预估滑点)（无申购费）
- **赎回价格**：NAV × (1 - 赎回费率 - 预估滑点)
- **管理费收取**：按日计提，通过稀释份额实现
- **费用分配**：
  - 赎回费：50%注入资金池，50%作为协议收入
  - 管理费：100%作为协议收入

### 2.4 流动性管理模块

#### 2.4.1 DEX集成
- **支持的DEX**：
  - 优先：Uniswap V3
  - 备选：SushiSwap、Curve（稳定币对）
- **智能路由**：
  - 自动寻找最优交易路径
  - 支持拆单以获得更好价格
  - 考虑Gas成本的路径优化

#### 2.4.2 流动性缓冲池
- **功能描述**：保留部分USDT作为缓冲
- **缓冲比例**：总资产的5-10%
- **用途**：
  - 快速处理小额赎回
  - 减少频繁交易产生的成本
  - 应对临时流动性需求

### 2.5 再平衡模块

#### 2.5.1 触发机制
- **定期再平衡**：每周执行一次（可配置）
- **阈值触发**：任一资产权重偏离目标>5%
- **手动触发**：管理员可手动触发

#### 2.5.2 执行策略
- **渐进式调整**：分批交易，避免市场冲击
- **成本控制**：预估Gas和滑点成本，成本过高时延迟执行
- **失败保护**：部分失败不影响整体运行

### 2.6 安全与风控模块

#### 2.6.1 权限管理
- **多签管理**：关键操作需要多签钱包确认
- **时间锁**：参数修改有24小时延迟生效
- **紧急暂停**：极端情况下可暂停申赎

#### 2.6.2 风险控制
- **单笔限额**：单笔申购不超过池子规模的10%
- **日累计限额**：每日申赎总额限制
- **黑名单机制**：可阻止恶意地址交互
- **审计要求**：上线前完成专业安全审计

### 2.7 数据统计模块

#### 2.7.1 链上数据
- **实时数据**：
  - 总锁仓价值（TVL）
  - 总份额供应量
  - 当前NAV
  - 24h申赎量
  - 持有人数量
- **历史数据**：
  - NAV历史曲线
  - 申赎记录
  - 再平衡记录

#### 2.7.2 性能指标
- **收益率**：日/周/月/年化收益率
- **波动率**：标准差、最大回撤
- **费用率**：实际收取的平均费率
- **跟踪误差**：与目标配置的偏离度

## 3. 用户界面需求

### 3.1 首页仪表板
- ETF产品列表（名称、NAV、24h涨跌、TVL）
- 市场概览（总TVL、总用户数）
- 热门ETF排行

### 3.2 产品详情页
- **基本信息**：名称、简介、成立时间
- **资产配置**：饼图展示当前配置 vs 目标配置
- **性能图表**：NAV走势、收益率曲线
- **持仓明细**：各资产数量、价值、占比
- **操作区域**：申购/赎回入口

### 3.3 申购界面
- **输入区**：
  - 选择支付币种（USDT/USDC）
  - 输入金额
  - 显示预估份额
- **费用明细**：
  - 管理费
  - 预估Gas费
  - 预估滑点
- **确认按钮**：连接钱包、授权、确认交易

### 3.4 赎回界面
- **输入区**：
  - 输入份额数量或比例
  - 选择接收币种
  - 显示预估金额
- **当前持仓**：显示用户持有份额和价值
- **费用明细**：同申购界面

### 3.5 个人中心
- **持仓概览**：各ETF持仓、总价值、总收益
- **交易历史**：申赎记录、时间、金额、状态
- **收益分析**：收益曲线、收益明细

## 4. 技术架构

### 4.1 智能合约
- **主合约**：ETF核心逻辑
- **份额代币合约**：ERC20实现
- **价格预言机合约**：价格获取和聚合
- **路由合约**：DEX交互和路径优化

### 4.2 技术栈
- **区块链**：Ethereum主网（后续支持L2）
- **开发框架**：Hardhat/Foundry
- **前端**：React + Web3.js/Ethers.js
- **预言机**：Chainlink
- **DEX集成**：Uniswap V3 SDK

### 4.3 部署计划
1. **测试网部署**：Goerli/Sepolia测试网
2. **安全审计**：专业第三方审计
3. **主网软启动**：限制TVL上限
4. **正式运营**：逐步放开限制

## 5. 里程碑计划

### Phase 1 - MVP（4周）
- 基础合约开发
- 单一ETF产品（3资产组合）
- 基本申赎功能
- 简单前端界面

### Phase 2 - 功能完善（4周）
- 多ETF产品支持
- 自动再平衡
- 数据统计面板
- UI/UX优化

### Phase 3 - 扩展升级（8周）
- L2部署（Arbitrum/Optimism）
- 更多资产类型
- 高级策略（杠杆、对冲）
- 移动端适配

## 6. 成功指标

### 6.1 短期目标（3个月）
- TVL达到100万美元
- 活跃用户数>500
- 日交易量>10万美元
- 零安全事故

### 6.2 中期目标（6个月）
- TVL达到1000万美元
- 活跃用户数>5000
- 支持10+种ETF产品
- 集成3+条链

### 6.3 长期愿景
- 成为链上ETF基础设施
- 支持用户自定义ETF
- 接入传统金融资产
- 实现完全去中心化治理

## 7. 风险与挑战

### 7.1 技术风险
- 智能合约漏洞
- 预言机失效
- DEX流动性不足
- Gas费用过高

### 7.2 市场风险
- 加密市场剧烈波动
- 监管政策不确定性
- 竞争产品出现
- 用户教育成本高

### 7.3 应对措施
- 多重安全审计
- 建立应急响应机制
- 保险基金设立
- 社区激励计划

## 8. 附录

### 8.1 竞品分析
- TokenSets
- Index Coop
- PieDAO
- Enzyme Finance

### 8.2 合规考虑
- KYC/AML要求评估
- 不同司法区域的合规性
- 必要的法律意见书

### 8.3 术语表
- **NAV**：Net Asset Value，净资产价值
- **TVL**：Total Value Locked，总锁仓价值
- **再平衡**：调整资产配置回到目标权重
- **滑点**：实际成交价与预期价格的差异