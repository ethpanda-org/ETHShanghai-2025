### **产品需求文档 (PRD): PayWay - MVP 版本**

| 文档版本 | v1.0 |
| :--- | :--- |
| **产品名称** | **PayWay** |
| **文档状态** | 草稿 |
| **创建日期** | 2025年10月18日 |

---

### **1. 产品概述 (Overview)**

#### **1.1 问题背景 (Problem Statement)**

在当前的 B2B 贸易，特别是跨境场景中，中小企业面临两大核心痛点：

1.  **技术门槛高：** 尽管 USDT 等稳定币在结算方面有巨大优势（高效、低成本），但非技术背景的企业在安全使用钱包、管理私钥、理解链上操作等方面存在巨大困难和风险。
2.  **信任与效率低下：** 传统的“一方打款，一方履约”流程中，存在严重的信任问题。买方担心付款后收不到合格的产品/服务，卖方担心履约后收不到钱。这导致了流程扯皮、人工确认效率低下，甚至交易失败。

#### **1.2 产品愿景 (Vision)**

我们的愿景是打造一个**无需区块链技术背景**即可使用的、基于智能合约的自动化资金托管与结算平台，让企业能够安全、高效地利用稳定币完成贸易结算，将商业信任从依赖“人”转变为依赖“代码”。

#### **1.3 目标用户 (Target Audience) - MVP 阶段**

*   **核心用户：** 从事跨境电商、数字服务外包、线上咨询等业务的中小企业和自由职业者。
*   **用户特征：** 对 稳定币 结算有一定认知和需求，但缺乏自行操作区块链的能力，交易金额多在中小额范围，对效率和安全性有较高要求。

---

### **2. 产品功能详述 (Features)**

**核心设计理念：** 本产品是一个去中心化应用 (dApp)，平台不托管用户资金或私钥。用户通过自己的钱包与智能合约交互，平台仅作为触发放款条件的“可信预言机”。

#### **2.1 Feature 1: 用户钱包连接 (Onboarding)**

*   **用户故事 (User Story):** 作为一个用户（付款方或收款方），我希望能够直接连接我现有的浏览器钱包（如 MetaMask），以便无需注册新账户即可安全地使用平台功能。
*   **功能需求 (Requirements):**
    1.  网站首页应有清晰、显著的“连接钱包”按钮。
    2.  点击后，自动调起用户的 MetaMask 浏览器插件请求授权。
    3.  连接成功后，页面应显示用户已连接的钱包地址（可做掩码处理，如 0x123...abcd）。
    4.  断开连接功能：用户可以随时主动断开钱包与网站的连接。
*   **技术规格：**
    *   **支持链：** Ethereum Sepolia (ETH)
    *   **支持钱包：** MetaMask,OkWallet等
    *   **集成：** 使用RainbowKit集成钱包登录

#### **2.2 Feature 2: 创建托管合约 (付款流程)**

*   **用户故事:** 作为一个付款方 (角色A)，我希望能在一个简单的页面上填写付款信息和放款条件，然后将资金安全地锁定在智能合约中，等待条件满足后自动支付给收款方。
*   **功能需求:**
    1.  提供一个简洁的合约创建表单，包含以下字段：
        *   `收款方钱包地址` (文本框，必填)：需进行地址格式校验。
        *   `支付币种` (下拉菜单，固定)：MVP 阶段固定为 **USDT (BEP20)**。
        *   `支付金额` (数字输入框，必填)：需进行有效数字校验。

        *   `验证方式` (下拉菜单，必填)：邮件/企业签，当前版本支持邮箱。
        *   `您的邮箱地址` (文本框，如果验证方式选择了邮箱，则必填)：需进行邮箱格式校验。
        *   `订单/合同编号` (文本框，必填，由系统随机生成)：用于业务识别。
    2.  用户填写完毕后，点击“创建并支付”按钮，触发**两步链上交易**：
        *   **第一步 (Approve)：** 调起 MetaMask，请求用户授权我们的智能合约可以从其钱包中划转指定金额的 USDT。
        *   **第二步 (Deposit)：** 再次调起 MetaMask，执行真正的转账操作，将 USDT 从用户钱包转入新创建的托管合约地址中。
    3.  整个过程需要有清晰的 UI 提示，引导用户完成两次钱包签名。
    4.  交易成功后，页面跳转至合约详情页，状态显示为 **“资金托管中”**。

#### **2.3 Feature 3: 触发资金释放 (放款流程)**

*   **用户故事:** 作为一个付款方 (角色A)，在确认对方已履约后，我希望能通过我预留的邮箱，向平台指定的邮箱发送一封包含特定指令的邮件，从而简单、快速地授权平台为我完成链上放款操作。
*   **功能需求:**
    1.  **前端展示：**
        * 在合约详情页，付款方 A 能看到一个“申请放款”按钮。
        * 点击后，弹窗展示提示内容。内容格式如下：
            > **如何放款？**
            >
            > 请使用您预留的邮箱 (`[用户预留的邮箱]`)
            >
            > 向我们的指令邮箱 `release@yourproduct.com`
            >
            > 发送一封邮件，邮件标题为：
            >
            > `RELEASE: [该合约的订单编号]`
            >
            > *我们将在收到邮件并验证通过后的数分钟内为您自动执行链上放款。*
    2.  **后端服务 (邮件监控预言机):**
        *   需要建立一个专用的后端服务，**实时监控**指定的指令邮箱 (`release@yourproduct.com`)。
        *   当收到新邮件时，服务自动执行以下操作：
            a.  **解析指令：** 从邮件标题中解析出指令（RELEASE）和`订单编号`。
            b.  **双重验证：**
                i.  **发件人验证：** 核对邮件的**发件人地址 (`From:`)** 是否与该`订单编号`对应的合约中，付款方 A 预留的邮箱地址**完全一致**。
                ii. **合约状态验证：** 查询数据库或区块链，确认该合约是否存在且当前状态为“资金托管中”。
            c.  **执行放款：** 只有在**双重验证全部通过**后，该服务才能使用平台的钱包（需预存少量 BNB 作为 Gas Fee）调用该笔合约的 `release()` (释放) 函数。
            d.  **失败处理：** 任何验证失败的邮件都应被记录并忽略，不做任何操作。
    3.  **状态更新与通知：**
        *   链上交易成功后，合约状态自动变更为 **“已完成”**。
        *   平台应向付款方 A 和收款方 C 的邮箱（如果C的邮箱已知）发送一封交易成功的通知邮件。

    

#### **2.4 Feature 4: 取消托管合约 (风险控制)**

*   **用户故事:** 作为一个付款方 (A) ，如果交易出现问题需要终止，我希望可以发起一个取消请求，并在对方同意后，让资金安全地退还给付款方。
*   **功能需求:**
    1.  在合约详情页，A 能看到一个“申请取消合约”按钮。
    2.  **发起取消：** A点击后，需在钱包中签名确认。合约状态变更为 **“已取消”**。
    4.  **确认后：** 智能合约自动执行退款逻辑，将托管的 USDT 全额退还给付款方 A 的钱包。

#### **2.5 Feature 5: 合约管理面板 (信息透明)**

*   **用户故事:** 作为一个用户，我连接钱包后，希望能看到一个与我相关的所有托管合约的列表和它们的状态，方便我追踪和管理我的每一笔交易。
*   **功能需求:**
    1.  用户连接钱包后，默认进入一个“我的合约”面板。
    2.  该面板以列表形式展示所有“我作为付款方”或“我作为收款方”的合约。
    3.  列表应至少包含 `订单编号`、`对方地址`、`金额`、`合约状态` 等关键信息。
    4.  提供简单的筛选或排序功能（如按状态筛选）。
    5.  点击任一合约，可进入该合约的详情页面，查看所有细节并进行相关操作（如申请放款、申请取消等）。

---

### **3. 非功能性需求 (Non-Functional Requirements)**

*   **安全性 (Security):**
    *   智能合约代码在上线主网前，**必须**通过至少一家专业安全公司的审计。
    *   前端代码应做好安全防护，防止 XSS 等常见攻击。
    *   后端用于发送邮件和触发合约的 API 必须做好权限校验和防重放攻击（通过一次性 Token 实现）。
*   **易用性 (Usability):**
    *   UI/UX 设计必须极度简洁、清晰，用用户听得懂的语言（如“资金托管中”）替代区块链术语（如“资产已转入合约地址”）。
    *   每一步关键操作都应有明确的指引和状态反馈。
*   **性能 (Performance):**
    *   网站加载速度快，与区块链的交互（如读取状态）应有合理的加载提示。
    *   后端服务响应要及时，确保邮件发送和链上交易触发的延迟在可接受范围内。

---

### **4. 未来规划 (Roadmap)**

本 PRD 仅定义 MVP 版本的功能范围，以下为后续迭代方向：

*   **行走阶段 (Walk):**
    *   **引入电子签名：** 集成企业级电子签名服务（如 DocuSign, e签宝），作为高级的、具备法律效力的放款条件，并作为付费功能。
    *   **多链/多币种支持：** 扩展到 TRON、Arbitrum 等更多公链，并支持 USDC 等其他主流稳定币。
*   **奔跑阶段 (Run):**
    *   **争议仲裁机制：** 引入去中心化或平台仲裁机制，解决交易双方出现纠纷无法达成一致的情况。
    *   **API 集成：** 提供 API 接口，让电商平台、服务外包平台等可以直接将我们的托管支付功能集成到他们的业务流中。
    *   **去中心化预言机：** 将放款条件的验证从平台中心化服务器迁移至 Chainlink 等去中心化预言机网络，实现更高程度的去信任化。